@using Webdiyer.WebControls.Mvc
@model PagedList<JiYiTunnelSystem.Dto.UserDto>

<table class="table table-striped">
    @if (Model.Count > 0)
    {
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Phone)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Email)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.IsAlarm)
            </th>
        </tr>

        foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Phone)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Email)
                </td>
                <td>
                    <div class="toggle-select-act fm-cmp-mg">
                        <div class="nk-toggle-switch">
                            @if (@item.IsAlarm == 0)
                            {
                                <input id=@item.Id type="checkbox" class="chk" value="@item.Id" />
                            }
                            else
                            {
                                <input id=@item.Id type="checkbox" checked="checked" class="chk" value="@item.Id" />
                            }
                            <label for=@item.Id class="ts-helper"></label>
                        </div>
                    </div>
                </td>
            </tr>
        }
    }
    else
    {
        <span class="tb-err-txt">无数据</span>
    }
    <tfoot>
        <tr>
            <td colspan="4">
                <nav>
                    @Ajax.Pager(Model, new PagerOptions {
                   PageIndexParameterName = "pageIndex",ContainerTagName = "ul", CssClass = "pagination",
                   CurrentPagerItemTemplate = "<li class=\"active\"><a href=\"#\">{0}</a></li>",
                   DisabledPagerItemTemplate = "<li class=\"disabled\"><a>{0}</a></li>",
                   PagerItemTemplate = "<li>{0}</li>", Id = "bootstrappager",
                   //RouteValues=new RouteValueDictionary { { "shaftSelect",ViewBag.ShaftSelect},{ "engSelect",ViewBag.EngSelect},
                   //    { "sectionSelect",ViewBag.SectionSelect} }
               }, new MvcAjaxOptions { UpdateTargetId ="tableData",DataFormId="alarmForm"})
                </nav>
            </td>
        </tr>
    </tfoot>
</table>

<script>
    $('.chk').change(function () {
        $.ajax({
            url: '/Home/ChangeUserIsAlarm',
            type: 'post',
            data: {
                id: this.id,
                alarm: this.checked
            }
        }).done(function (data) {
            if (data.res == "ok") {
                return;
            } else if (data.res == "err") {
                swal.fire({
                    title: "设置失败",
                    icon: "warning",
                    showCancelButton: false,
                    confirmButtonText: "确定",
                    confirmButtonColor: "#00C292"
                }).then(function () { }).catch(function () { });
            }
        })
    })
</script>