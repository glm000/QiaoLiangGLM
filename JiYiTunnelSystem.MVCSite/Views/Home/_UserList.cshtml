@using Webdiyer.WebControls.Mvc
@model PagedList<JiYiTunnelSystem.Dto.UserDto>

<table class="table table-striped">
    @if (Model.Count > 0)
    {
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Phone)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Email)
            </th>
            <th>
                @Html.DisplayNameFor(model=>model.Authority)
            </th>
            <th>
                @Html.DisplayNameFor(model=>model.CreateTime)
            </th>
        </tr>

        foreach (var item in Model)
        {
        <tr>
            <td>
                @Html.HiddenFor(modelItem=>item.Id)
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Phone)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Email)
            </td>
            <td>
                @Html.DropDownList(item.Id.ToString(), new SelectList(ViewBag.Roles, "Id", "Name", item.Authority), new { @id=item.Id.ToString(),@onchange = "changeRole(this.id)" })
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreateTime)
            </td>
        </tr>
        }
    }
    else
    {
        <span class="tb-err-txt">无数据</span>
    }
    <tfoot>
        <tr>
            <td colspan="5">
                <nav>
                    @Ajax.Pager(Model, new PagerOptions {
                   PageIndexParameterName = "pageIndex",ContainerTagName = "ul", CssClass = "pagination",
                   CurrentPagerItemTemplate = "<li class=\"active\"><a href=\"#\">{0}</a></li>",
                   DisabledPagerItemTemplate = "<li class=\"disabled\"><a>{0}</a></li>",
                   PagerItemTemplate = "<li>{0}</li>", Id = "bootstrappager",
                   //RouteValues=new RouteValueDictionary { { "shaftSelect",ViewBag.ShaftSelect},{ "engSelect",ViewBag.EngSelect},
                   //    { "sectionSelect",ViewBag.SectionSelect} }
               }, new MvcAjaxOptions { UpdateTargetId ="tableData",DataFormId="alarmForm"})
                </nav>
            </td>
        </tr>
    </tfoot>
</table>

<style>
    select {
        width: 100px;
        padding-left: 13px;
        border: 1px solid #ccc;
        /*-webkit-appearance: none; for Webkit browsers*/
        outline: none
    }
        select:focus {
            border-color: #66afe9;
            box-shadow: 0 0 8px #66afe9;
        }
</style>

<script>
    function changeRole(obj) {
        var role = document.getElementById(obj).value;
        $.ajax({
            url: '/Home/ChangeUserAuth',
            type: 'post',
            data: {
                id: obj,
                role:role
            }
        }).done(function (data) {
            if (data.res == "ok") {
                return;
            } else if (data.res == "err") {
                swal.fire({
                    title: "设置失败",
                    icon: "warning",
                    showCancelButton: false,
                    confirmButtonText: "确定",
                    confirmButtonColor: "#00C292"
                }).then(function () { }).catch(function () { });
            }
        })
    }
</script>