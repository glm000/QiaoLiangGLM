@using Webdiyer.WebControls.Mvc
@model PagedList<JiYiTunnelSystem.Dto.SensorDto>

@{
    ViewBag.Title = "设备列表";
}
<div class="data-table-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12 mg-b-20">
                <div class="inbox-left-sd">
                    <div class="compose-ml"><a class="btn">设备中心</a></div>
                    <div class="inbox-status">
                        <ul class="inbox-st-nav">
                            <li><a href=@Url.Action("SensorList","Home",new { type="0"})><i class="notika-icon notika-form"></i>设备列表</a></li>
                            <li><a href=@Url.Action("CreateSensor","Home")><i class="notika-icon notika-plus-symbol"></i>添加设备</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-10 col-md-9 col-sm-9 col-xs-12 mg-b-20">
                <div class="form-element-list">
                    @using (Ajax.BeginForm("Test",new RouteValueDictionary { { "typeSelect",""} } ,new AjaxOptions { UpdateTargetId = "tableData",HttpMethod="Get",LoadingElementId="loading" }, new RouteValueDictionary{ { "id", "search" } }))
                     {
                        <div class="row">
                            <div class="col-lg-2 col-md-3 col-sm-4">
                                <span class="tb-select-txt">竖井:&nbsp;</span>
                                <div class="bootstrap-select tb-select">
                                    <select id="shaftSelect" name="shaftSelect" class="selectpicker" onchange="changeShaft()">
                                        <option value="2">2号竖井</option>
                                        <option value="4">4号竖井</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-5">
                                <span class="tb-select-txt">部位:&nbsp;</span>
                                <div class="bootstrap-select tb-select">
                                    <select id="engSelect" name="engSelect" class="selectpicker" onchange="changeEngineering(this.value)">
                                        <option value="2">初支与二衬背后</option>
                                        <option value="4">斜井</option>
                                        <option value="1">应急封堵墙</option>
                                        <option value="3">正洞</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-4">
                                <span class="tb-select-txt">截面:&nbsp;</span>
                                <div class="bootstrap-select tb-select">
                                    <div id="sectionList">
                                        @{ Html.RenderAction("SectionSelect2", new { engId = 2, shaft = 2 });}
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-4">
                                <span class="tb-select-txt">类型:&nbsp;</span>
                                <div class="bootstrap-select tb-select">
                                    <select id="typeSelect" name="typeSelect" class="selectpicker" onchange="changeType()">
                                        <option value="0">全部</option>
                                        <option value="YB">应变</option>
                                        <option value="WY">位移</option>
                                        <option value="ZD">震动</option>
                                        <option value="YL">压力</option>
                                        <option value="GJ">钢筋应力</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                     }
                </div>
            </div>
            <div class="col-lg-10 col-md-9 col-sm-9 col-xs-12">
                <div class="data-table-list sm-res-mg-t-30">
                    <div class="basic-tb-hd">
                        <h2>@ViewBag.Title<span class="pull-right">总计:@ViewBag.TotalCount /在线:@ViewBag.OnlineCount</span></h2>
                    </div>
                    <div class="table-responsive data-list tb-txt">
                        <div id="tableData">
                            @Html.Partial("_SensorTableData", Model)
                        </div>

                        <div id="loading" class="loading" style="display:none">
                            <div class="pic">
                                <i></i>
                                <i></i>
                                <i></i>
                                <i></i>
                                <i></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section head{
    <style>
        .loading{
            width:100%;height:100%;
            background:#fff;
            /*position:fixed;top:0;left:0;z-index:2;*/
        }
        .loading .pic{
            position:absolute;top:0;bottom:0;
            left:0;right:0;margin:auto;
            width:70px;height:60px;
        }
        .loading .pic i{
            display:inline-block;width:6px;height:60px;
            background:#ccc;margin:0 2px;transform:scaleY(0.4);
            animation:load 1.0s infinite;
        }
        @@keyframes load{
            0%,40%,100%{transform:scaleY(0.4);}
            20%{transform:scaleY(1);}
        }
        .loading .pic .inbox-left-sd:nth-child(2){animation-delay:.1s;}
        .loading .pic .inbox-left-sd:nth-child(3) {
            animation-delay: .2s;
        }
        .loading .pic .inbox-left-sd:nth-child(4) {
            animation-delay: .3s;
        }
        .loading .pic .inbox-left-sd:nth-child(5) {
            animation-delay: .4s;
        }
    </style>    
}

@section scripts{
    @{Html.RegisterMvcPagerScriptResource();}
    @Scripts.Render("~/bundles/ajax")
    <script>
        function changeShaft() {
            var engId = document.getElementById('engSelect').value;
            changeEngineering(engId);
        }

        function changeEngineering(engId) {
            var shaft = document.getElementById('shaftSelect').value;
            var str = '/Home/SectionSelect2?engId=' + engId + '&shaft=' + shaft;
            var obj = document.getElementById('sectionList');
            obj.innerHTML = "";
            $('#sectionList').load(str);
            var interval_temp = setInterval(function () {
                if (obj.innerHTML) {
                    clearInterval(interval_temp);
                    $('.selectpicker').selectpicker('refresh');
                    $('#search').submit();
                }
            }, 100)
        }

        function changeSection(obj) {
            $('#search').submit();
        }

        function changeType() {
            $('#search').submit();
        }
    </script>
}